script.
	import { afterUpdate } from 'svelte'
	import CommentTree from './CommentTree.pug'
	export comments = []
	commentsContainer = null
	minimapCanvas = null
	minimapH = comments.length * 8 # TODO
	minimapW = 24
	drawMinimap = (target) =>
		ctx = minimapCanvas.getContext('2d')
		ctx.clearRect(0, 0, minimapW, minimapH)
		ctx.fillStyle = 'rgba(0, 0, 0, 0.5)'
		ctx.fillRect(10, 0, 4, minimapH)
		scrollFrac = (target.scrollTop or restoredScroll or 0) / target.scrollHeight
		pointerTop = Math.floor(scrollFrac * minimapH)
		ctx.fillRect(0, pointerTop, minimapW, Math.floor(minimapH * target.clientHeight / target.scrollHeight))
	afterUpdate(=> drawMinimap(commentsContainer))
	onScroll = (e) =>
		drawMinimap(commentsContainer)
		bubbleEvent(e)

section.scroll-tall.no-scrollbar#comments(bind:this={commentsContainer})
	{#each comments as comment}
		CommentTree(comment={comment})
	canvas.minimap(bind:this={minimapCanvas} width={minimapW} height={minimapH})

style.
	section
		position relative
		display flex
		flex-flow column nowrap
		padding-right 80px
		background inherit
	.minimap
		position fixed
		top 0
		right 8px