script.
	import api from '../../../api/index.js'
	import Avatar from '../user/Avatar.pug'
	import Button from '../controls/Button.pug'
	import Markup from '../text/Markup.pug'
	import Score from './Score.pug'
	export id = null
	export showReplies = true
	export topLevel = false
	collapsed = false
	comment = null
	api.watch(id, (x) -> { data: comment } = x)

{#if comment}
	<!-- 'comment' role is draft status and not recognized yet -->
	<!-- svelte-ignore a11y-unknown-role -->
	article.comment(role='comment')
		{#if topLevel}
			.comment-layout-score
				Score(value={comment.score || comment.score_hidden})
		.comment-layout-indent
			Avatar(username={comment.author})
			button.comment-line-separator(on:mousedown={() => collapsed = !collapsed})
		.comment-layout-core
			{#if collapsed}
				.comment-collapsed [ Comment collapsed. ]
			{:else}
				.comment-body
					Markup(html={comment.body_html})
				{#if showReplies && comment.replies.length > 0}
					ol.comment-replies
						{#each comment.replies as replyId}
							svelte:self(id={replyId})
						{#if comment.more_replies}
							.comment-more-replies
								Button(appearance='text' text="+ {comment.more_replies.length} more {comment.more_replies.length === 1 ? 'reply' : 'replies'}...")
						{#if comment.deeper_replies}
							.comment-more-replies
								Button(appearance='text' text='â†’ Continue this thread...')

style.
	.comment
		display flex
		gap 1ch
		margin-top 1.5em
		position relative
	:global(.comment-body img)
		border-radius 6px
		display inline
		margin-block-start 1px
		margin-inline-start 1px
		max-height 9em
		width auto
	.comment-layout-indent
		display flex
		flex 0 0 24px
		flex-flow column nowrap
	.comment-layout-score
		position absolute
		right calc(100% + 1em)
	.comment-line-separator
		background linear-gradient(to right, transparent 11px, currentColor 11px, currentColor 12px, transparent 12px)
		flex 1
		margin-top 1em
		opacity 0.1
	.comment-more-replies
		margin-top 1.5em
	.comment-replies
		margin-top 1.5em