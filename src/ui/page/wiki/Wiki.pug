script.
	import api from '../../../api/index.js'
	import { Time } from '../../../lib/index.js'

	import Base404 from '../../base/Base404.pug'
	import TextHTML from '../../framework/TextHTML.pug'
	
	export page_name = null
	export revision_id = null
	export subreddit_name = null
	
	error = null
	loading = false
	page = null
	api.loadWatch(
		(if revision_id
			api.ID('wiki', subreddit_name, page_name, revision_id)
		else
			api.ID('wiki', subreddit_name, page_name)),
		(x) ->
			{ data: page, error, loading } = x
	)

svelte:head
	title  r/{subreddit_name} - Wiki - {page_name}
{#if error}
	{#if error instanceof api.errors.ServerError}
		Base404(path="/r/{subreddit_name}/wiki/{page_name}{revision_id ? '?v=' + revision_id : ''}")
{:else if loading}
	p Loading...
{:else if page}
	article.wiki-page
		h1.wiki-page-name {subreddit_name} / {page_name.split('/').join(' / ')}
		.wiki-page-info
			.wiki-page-edit-date Revised {Time.sToRelTimeStr(page.revision_date, { abbr: false })} ago
		article.wiki-page-body
			TextHTML(html={page.content_html})

style.
	.wiki-page-body
		margin-top 3em
	.wiki-page-info
		align-items center
		display flex
		font-size 12px
		gap 1ch
		margin-top 1em
		opacity 0.5
	.wiki-page-name
		font-size 2em
	:global(.wiki-page img)
		max-width 100%
	:global(.wiki-page .toc)
		font-size 12px
		line-height 1
		max-height 100vh
		overflow auto
		padding 8em 0
		position fixed
		left 70vw
		top 0
		&::-webkit-scrollbar
			display none
	:global(.wiki-page .toc > ul)
		padding 2.25em 1.5em !important
		position relative
		&::before
			background rgba(0,0,0,0.1)
			content 'Table of Contents'
			line-height 2
			opacity 0.5
			padding 0 0.25em
			position absolute
			text-transform uppercase
			top -1em
	:global(.wiki-page .toc li)
		margin-top 1em
	:global(.wiki-page .toc ol)
	:global(.wiki-page .toc ul)
		padding 0
	:global(.wiki-page .toc ol ol)
	:global(.wiki-page .toc ol ul)
	:global(.wiki-page .toc ul ol)
	:global(.wiki-page .toc ul ul)
		border-left 1px solid rgba(0,0,0,0.1)
		padding-left 1em