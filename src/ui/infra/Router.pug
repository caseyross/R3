script.
	import Post from '../product/post/Post.pug'
	import Multireddit from '../product/multireddit/Multireddit.pug'
	import MultiredditAll from '../product/multireddit/MultiredditAll.pug'
	import MultiredditHome from '../product/multireddit/MultiredditHome.pug'
	import MultiredditPopular from '../product/multireddit/MultiredditPopular.pug'
	import Subreddit from '../product/subreddit/Subreddit.pug'
	import UserProfile from '../product/user/UserProfile.pug'
	import WikiPage from '../product/wiki/WikiPage.pug'
	import parseRoute from './parseRoute.coffee'
	route = parseRoute(location)
	navigate = (url, options = { replace: false }) ->
		if options.replace
			history.replaceState(null, null, url)
		else
			history.pushState(null, null, url)
	document.addEventListener('mousedown',
		(event) ->
			if event.button is 0 and not (event.altKey or event.ctrlKey or event.metaKey or event.shiftKey)
				parentLink = event.target.closest('a')
				if parentLink?
					if parentLink.origin is origin
						if parentLink.pathname != location.pathname
							navigate(new URL(parentLink.href))
							route = parseRoute(location)
							event.preventDefault()
					else
						location.href = parentLink.href
						event.preventDefault())
	document.addEventListener('keydown',
		(event) ->
			if event.key is 'Enter' and not (event.altKey or event.ctrlKey or event.metaKey or event.shiftKey) and event.target.tagName is 'A' and event.target.origin is origin and event.target.pathname != location.pathname
				navigate(new URL(event.target.href))
				route = parseRoute(location)
				event.preventDefault())
	window.addEventListener('popstate',
		(event) ->
			route = parseRoute(location)
			event.preventDefault())

{#if route.path === 'all'}
	MultiredditAll(posts_sort={route.data.posts_sort})
{:else if route.path === 'home'}
	MultiredditHome(posts_sort={route.data.posts_sort})
{:else if route.path === 'multireddit'}
	Multireddit(name={route.data.multireddit_name} posts_sort={route.data.posts_sort} user_name={route.data.user_name})
{:else if route.path === 'popular'}
	MultiredditPopular(posts_sort={route.data.posts_sort})
{:else if route.path === 'post'}
	Post(shortId={route.data.post_short_id})
{:else if route.path === 'subreddit'}
	Subreddit(name={route.data.subreddit_name} sort={route.data.posts_sort})
{:else if route.path === 'user'}
	UserProfile(items_filter={route.data.items_filter} items_sort={route.data.items_sort} user_name={route.data.user_name})
{:else if route.path === 'wiki_page'}
	{#key route}
		WikiPage(page_name={route.data.page_name} revision_id={route.data.revision_id} subreddit_name={route.data.subreddit_name})
{:else}
	h1 The requested page is not supported yet.
	dl
		dt Page type:
		dd {route.path}
		dt Data:
		dd
			{#if route.data === null}
				| [null]
			{:else}
				dl
					{#each Object.keys(route.data) as key}
						dt {key}:
						dd {route.data[key]}

style.
	dd
		font-weight bold