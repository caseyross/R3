script.
	import { getContext } from 'svelte'
	import api from '../../api/index.js';
	import Button from '../common/Button.pug'
	import PopupWindow from '../common/PopupWindow.pug'
	show_feedback = false
	show_help = false
	show_settings = false
	unread_mention_count = 0
	unread_message_count = 0
	unread_reply_count = 0
	if getContext('username')
		api.loadWatch('current_user_messages',
			({ comment_replies, post_replies, private_messages, username_mentions }) ->
				unread_mention_count = username_mentions?.length or 0
				unread_message_count = private_messages?.length or 0
				unread_reply_count = (post_replies?.length + comment_replies?.length) or 0
		)

nav#global-nav
	section
		Button(key='h' link='/' text='Home')
		br
		{#if getContext('username')}
			Button(badge={unread_reply_count || null} key='~' link='/mail/replies' text='Replies')
			Button(badge={unread_message_count || null} key='!' link='/mail/messages' text='Messages')
			Button(badge={unread_mention_count || null} key='@' link='/mail/mentions' text='Mentions')
		Button(key='/' text='Go...')
	section
		Button(action={() => show_help = true} key='?' text='Help')
		Button(action={() => show_settings = true} key='*' text='Settings')
		Button(action={() => show_feedback = true} key='>' text='Feedback')
		br
		{#if getContext('username')}
			Button(action={() => { api.logout(); localStorage.clear(); location.reload() }} key='&' text='Unlink Reddit Account')
		{:else}
			Button(key='&' link={api.getLoginURL({ memoString: location.pathname })} text='Login with Reddit Account...')
PopupWindow(exit_action={() => show_help = false} title='Help' visible={show_help})
PopupWindow(exit_action={() => show_settings = false} title='Settings' visible={show_settings})
PopupWindow(exit_action={() => show_feedback = false} title='Feedback' visible={show_feedback})

style.
	section
		display flex
		flex-flow column nowrap
	#global-nav
		display flex
		flex-flow column nowrap
		justify-content space-between
		left 0
		height 100%
		padding 10px 0
		position fixed
		display none