script.
	import { relativize_url } from '../../app/routing/url.coffee'

	import Button from '../../common/Button.pug'
	import FormattedHTML from '../../common/FormattedHTML.pug'

	import PostFlair from '../post/PostFlair.pug'
	import SubredditTag from './SubredditTag.pug'

	export widget = null

.subreddit-widget
	{#if widget.kind === 'button'}
		header.subreddit-widget-title {widget.shortName}
		ol.subreddit-widget-links
			{#each widget.buttons as button}
				Button(link={relativize_url(button.url)} text={button.text})
	{:else if widget.kind === 'community-list'}
		header.subreddit-widget-title {widget.shortName}
		ol.subreddit-widget-related-subreddits
			{#each widget.data as subreddit}
				SubredditTag(name={subreddit.name})
	{:else if widget.kind === 'image'}
		{@const image = widget.data[0]}
			{#if image.linkUrl}
				a(href={relativize_url(image.linkUrl)})
					img.subreddit-widget-image(alt={widget.shortName} src={image.url} style='aspect-ratio: {image.width}/{image.height}')
			{:else}
				img.subreddit-widget-image(alt={widget.shortName} src={image.url} style='aspect-ratio: {image.width}/{image.height}')
	{:else if widget.kind === 'menu'}
		ol.subreddit-widget-menu
			{#each widget.data as item}
				{#if item.children}
					details
						summary {item.text}
						ol.subreddit-widget-menu-list
							{#each item.children as child}
								Button(link={relativize_url(child.url)} text={child.text})
				{:else}
					Button(link={relativize_url(item.url)} text={item.text})
	{:else if widget.kind === 'post-flair'}
		header.subreddit-widget-title Filter by Flair
		ol.subreddit-widget-post-flairs
			{#each widget.order.map(x => widget.templates[x]) as flair}
				a(href="?f=flair_name:'{flair.text}'")
					PostFlair(color={flair.backgroundColor} emoji_style='image' rich_text={flair.richtext} text={flair.text})
	{:else if widget.kind === 'textarea'}
		header.subreddit-widget-title {widget.shortName}
		FormattedHTML(html={widget.textHtml})

style.
	.subreddit-widget-image
		border-radius 10px
	.subreddit-widget-links
		display flex
		flex-flow row wrap
		gap 0.5em
	.subreddit-widget-menu
		align-items flex-start
		display flex
		flex-flow column nowrap
		gap 10px
	.subreddit-widget-menu-list
		display flex
		flex-flow row wrap
		gap 0.5em
	.subreddit-widget-post-flairs
		display flex
		flex-flow row wrap
		gap 10px
	.subreddit-widget-related-subreddits
		display flex
		flex-flow column nowrap
		gap 10px
	.subreddit-widget-title
		font-weight 900
		margin-bottom 1em