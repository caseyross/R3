script.
	import api from '../../../api/index.js'

	import Button from '../../common/Button.pug'
	import Date from '../../common/Date.pug'
	import FormattedHTML from '../../common/FormattedHTML.pug'

	import SubredditModerators from './SubredditModerators.pug'
	import SubredditRules from './SubredditRules.pug'
	import SubredditWidget from './SubredditWidget.pug'

	export name = null

	info = null
	api.loadWatch(api.ID('subreddit', name), (x) ->
		{ data: info } = x
	)
	widgets = null
	api.loadWatch(api.ID('subreddit_widgets', name), (x) ->
		{ data: widgets } = x
	)

aside.subreddit-sidebar
	{#if info}
		section
			{#if info.banner_background_image || info.banner_img}
				p
					a(href={info.banner_background_image || info.banner_img})
						img.subreddit-sidebar-banner-image(alt='' src={info.banner_background_image || info.banner_img})
			table.subreddit-sidebar-stats
				thead
					tr
						th.subreddit-sidebar-stats-label(align='left') Created
						th.subreddit-sidebar-stats-label(align='right') Subscribers
				tbody
					tr
						td.subreddit-sidebar-stats-value(align='left')
							Date(created_s={info.created_utc})
						td.subreddit-sidebar-stats-value(align='right') {info.subscribers.toLocaleString('en-US')}
			{#if info.public_description_html}
				FormattedHTML(html={info.public_description_html})
			menu.subreddit-sidebar-additional-options
				Button(popup={true} text='Rules')
					SubredditRules(name={name})
				{#if api.isLoggedIn()}
					Button(popup={true} text='Moderators')
						SubredditModerators(name={name})
				{#if info.wiki_enabled}
					Button(link='/r/{name}/wiki/index' text='Wiki')
	{#if widgets}
		ol.subreddit-sidebar-widgets
			{#each widgets.sidebar as widget}
				SubredditWidget(widget={widget})
	{#if info?.header_title}
		br
		br
		span(style='color:var(--c-text-weak)') "{info.header_title}"

style.
	.subreddit-sidebar
		width 256px
	.subreddit-sidebar-additional-options
		display flex
		gap 10px
		padding 10px 0
		justify-content flex-end
	.subreddit-sidebar-banner-image
		border-radius 99px
		height 64px
		object-fit cover
		width 100%
	.subreddit-sidebar-stats
		margin-bottom 10px
		width 100%
	.subreddit-sidebar-stats-label
		color var(--c-text-weak)
	.subreddit-sidebar-stats-value
		font-size 2em
	.subreddit-sidebar-widgets
		display flex
		flex-flow column nowrap
		gap 0.5em