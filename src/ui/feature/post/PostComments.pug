script.
	import { setContext } from 'svelte';
	import api from '../../../api/index.js'

	import Button from '../../common/Button.pug'
	import Comment from '../comment/Comment.pug'
	
	export focus_comment_parent_count = null
	export focus_comment_short_id = null
	export post_short_id = null
	export sort = null

	loading = false
	more_replies_loading = false
	post = null
	if focus_comment_short_id
		setContext('focus_comment_short_id', focus_comment_short_id)
	api.loadWatch(api.ID('post', post_short_id, sort or 'confidence', 25, focus_comment_short_id, focus_comment_parent_count), (x) ->
		{ data: post, loading } = x
		if post?.more_replies
			api.watch(post.more_replies_id, (x) ->
				{ loading: more_replies_loading } = x
			)
	)

ol
	{#if post}
		{#each post.replies as reply_short_id (reply_short_id)}
			Comment(short_id={reply_short_id})
		{#if post.num_more_replies > 0}
			.post-more-replies
				Button(action={() => api.load(post.more_replies_id)} icon_plus={true} loading={more_replies_loading} text="{post.num_more_replies} more")
	{:else if loading}
		.post-comments-loading-notification Loading...

style.
	ol
		margin 0.666em 0
	.post-comments-loading-notification
		color var(--c-text-weak)
		padding 1em 0
	.post-more-replies
		padding 0.666em 0