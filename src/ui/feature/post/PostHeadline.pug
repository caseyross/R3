script.
	import api from '../../../api/index.js'
	import { Time } from '../../../lib/index.js'

	import SubredditTag from '../subreddit/SubredditTag.pug'
	import PostFlair from './PostFlair.pug'

	export post_short_id = null
	export selected = false
	export show_subreddit = false
	
	post = api.read(api.ID('post', post_short_id))?.data
	if !post
		api.loadWatch(api.ID('post', post_short_id, 'confidence', 25), (x) ->
			{ data: post } = x
		)
	else if post.num_comments > 0 and !post.replies?.length
		api.preload(api.ID('post', post_short_id, 'confidence', 25), (x) ->
			{ data: post } = x
		)

{#if post}
	article.post-headline(class:post-downvoted={post.likes === false} class:post-nsfw={post.over_18} class:post-read={localStorage['visited.' + post_short_id] || false} class:post-selected={selected} class:post-stickied={post.stickied} class:post-upvoted={post.likes === true} class:post-with-low-score={post.score < 1} data-likes={post.likes} data-radial-menu='post' data-short_id={post_short_id} title={post.edited ? Time.sToAbsRelTimeStr(post.created_utc) + ' (edited ' + Time.sToAbsRelTimeStr(post.edited) + ')' : Time.sToAbsRelTimeStr(post.created_utc)})
		{#if show_subreddit}
			SubredditTag(name={post.subreddit})
		{:else if post.link_flair_text}
			PostFlair(color={post.link_flair_background_color} emoji_style='image' rich_text={post.link_flair_richtext} text={post.link_flair_text})
		h1.post-title(class:md-spoiler-text={post.spoiler}) {post.title}
		button.post-score(on:mousedown={() => api.submit(api.ID('post_vote', post_short_id), { numerical_vote: post.likes ? 0 : 1 })}) {post.hide_score ? '?' : post.score} ({post.num_comments}) 

style.
	.post-headline
		align-items flex-start
		display flex
		flex-flow column nowrap
		gap 6px
		margin-left 80px
		position relative
		width 160px
		&.post-with-low-score
			opacity 0.5
	.post-score
		align-items center
		color var(--c-text-weak)
		display flex
		gap 6px
		position absolute
		right calc(100% + 1em)
		white-space pre
	.post-title
		font-size 16px
		font-weight inherit
		margin 0
		overflow-wrap anywhere