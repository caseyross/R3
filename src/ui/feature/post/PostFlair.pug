script.
	import api from '../../../api/index.js'
	import { Color } from '../../../lib/index.js'
	export color = null
	export emoji_style = null
	export rich_text = null
	export subreddit_name = null
	export text = null

	background_color = color or 'var(--c-subreddit-theme-default)'
	text_color =
		if color
			if (new Color({ hex: color })).isDark() then 'white' else 'black'
		else
			'var(--c-subreddit-theme-text-default)'
	if !color and subreddit_name
		api.loadWatch(api.ID('subreddit', subreddit_name), ({ data: subreddit }) ->
			if subreddit?.primary_color or subreddit?.key_color
				background_color = subreddit.primary_color or subreddit.key_color
				text_color = if (new Color({ hex: background_color })).isDark() then 'white' else 'black'
		)

span.post-flair(style="background-color: {background_color}; color: {text_color}" title={text})
	{#if rich_text && rich_text.length}
		{#each rich_text as segment}
			{#if segment.e === 'text'}
				| {segment.t}
			{:else if segment.e === 'emoji' && emoji_style !== null}
				{#if emoji_style === 'image'}
					img.post-flair-emoji(alt={segment.a} src={segment.u} title={segment.a})
				{:else if emoji_style === 'text'}
					| {segment.a}
	{:else}
		| {text}

style.
	.post-flair
		border-radius 6px
		display inline-flex
		font-feature-settings 'calt' 1, 'tnum' 1
		font-size 10px
		font-weight bold
		height 16px
		letter-spacing 1px
		line-height 1
		padding 3px 6px
		text-transform uppercase
		user-select none
	.post-flair-emoji
		height 16px
		margin-block-start -3px
		margin-inline-end 2px