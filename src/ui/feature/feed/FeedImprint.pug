script.
	import { getContext } from 'svelte'
	import api from '../../../api/index.js'
	
	import SubredditAvatar from '../subreddit/SubredditAvatar.pug'
	import UserAvatar from '../user/UserAvatar.pug'
	
	export feed_type = null
	
	export collection_short_id = null
	export multireddit_name = null
	export subreddit_name = null
	export user_name = null
	
	error = null
	info = null
	set_theme_color = getContext('set_theme_color')
	if feed_type != 'subreddit'
		set_theme_color()
	switch feed_type
		when 'collection'
			api.loadWatch(api.ID('collection', collection_short_id), (x) ->
				{ data: info, error } = x
			)
		when 'multireddit'
			api.loadWatch(api.ID('multireddit', user_name, multireddit_name), (x) ->
				{ data: info, error } = x
			)
		when 'subreddit'
			api.loadWatch(api.ID('subreddit', subreddit_name), (x) ->
				{ data: info, error } = x
				set_theme_color(info?.primary_color || info?.key_color)
			)
		when 'user'
			api.loadWatch(api.ID('user', user_name), (x) ->
				{ data: info, error } = x
			)

{#if error}
	.feed-info.feed-info-unavailable
{:else if info}
	{#if feed_type === 'collection'}
		a.feed-info(href='/c/{collection_short_id}')
			section.feed-info-avatar
				img.feed-info-avatar-image(alt='')
				span.feed-info-avatar-owner-image
					UserAvatar(name={info.author_name})
			section.feed-info-data
				span.feed-info-list-type Collection
				strong.feed-info-list-name {info.title}
	{:else if feed_type === 'multireddit'}
		a.feed-info(href='/m/{user_name}/{multireddit_name}')
			section.feed-info-avatar
				img.feed-info-avatar-image(alt='')
				span.feed-info-avatar-owner-image
					UserAvatar(name={info.owner})
			section.feed-info-data
				span.feed-info-list-type Multireddit
				strong.feed-info-list-name {user_name}/{multireddit_name}
	{:else if feed_type === 'subreddit'}
		a.feed-info(href='/{subreddit_name}' style='display:flex')
			section.feed-info-avatar
				SubredditAvatar(name={subreddit_name} size='large')
			section.feed-info-data
				span.feed-info-list-type Subreddit
				strong.feed-info-list-name(title={info.display_name}) {info.display_name.startsWith('u_') ? 'u/' + info.display_name.slice(2) : info.display_name}
	{:else if feed_type === 'user'}
		a.feed-info(href='/u/{user_name}')
			section.feed-info-avatar
				img.feed-info-avatar-image(alt='' src={info.profile_img})
			section.feed-info-data
				span.feed-info-list-type User
				strong.feed-info-list-name {user_name}

style.
	.feed-info
		align-items center
		display flex
		gap 10px
	.feed-info-avatar
		flex 0 0 auto
		position relative
		width 64px
	.feed-info-avatar-image
		aspect-ratio 1
		border-radius 50%
		object-fit cover
		width 100%
	.feed-info-avatar-owner-image
		bottom -10px
		position absolute
		right 0
	.feed-info-data
		display flex
		flex-flow column nowrap
	.feed-info-list-name
		font-size 1.5em
	.feed-info-list-type
		color var(--c-text-weak)