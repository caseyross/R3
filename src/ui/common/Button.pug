script.
	import { hotkey } from './actions/hotkeys.coffee'
	import HotkeyLabel from './HotkeyLabel.pug'
	import Popup from './Popup.pug'
	
	export action = ->
	export activated = false
	export badge = null
	export description = ''
	export disabled = false
	export key = null
	export icon_plus = null
	export link = null
	export loading = false
	export new_tab = false
	export options = null
	export popup = false
	export selected_value = null
	export text = ''

	popup_open = false
	if popup
		action = -> popup_open = true

{#if options}
	select.button.button-dropdown(class:button-activated={activated} disabled={disabled || loading} on:change={e => action(e.target.value)} title={description} use:hotkey={key})
		{#each options as option}
			option.button-dropdown-option(disabled={option.disabled} label={option.label} selected={selected_value === option.value} value={option.value})
{:else if link}
	a.button(class:button-activated={activated} class:button-disabled={disabled} class:button-with-icon-plus={icon_plus} href={disabled ? null : link} target={new_tab ? '_blank' : ''} title={description} use:hotkey={key})
		{#if key}
			HotkeyLabel(key={key})
		{#if text}
			| {text}
		{#if badge}
			span.button-badge {badge}
{:else}
	button.button(class:button-activated={activated} class:button-with-icon-plus={icon_plus} disabled={disabled || loading} on:keydown={e => e.key === 'Enter' && action()} on:mousedown={e => e.button === 0 && action()} title={description} use:hotkey={key})
		{#if loading}
			| loading...
		{:else}
			{#if key}
				HotkeyLabel(key={key})
			{#if text}
				| {text}
			{#if badge}
				span.button-badge {badge}
{#if popup}
	Popup(on:close={() => popup_open = false} open={popup_open} title={text})
		slot


style.
	.button
		align-items center
		background var(--c-blend-normal)
		border 1px solid transparent
		border-radius 6px
		display inline-flex
		gap 5px
		line-height 18px
		padding 4px 6px
		position relative
		text-align left
		user-select none
		&:hover:not(:disabled):not(.disabled):not(.button-dropdown)
			background var(--c-con-normal)
			border-color var(--c-hint-normal)
			color var(--c-hint-normal)
		&.button-activated
			background var(--c-text-strong)
			color var(--c-text-reverse)
		&.button-disabled
		&:disabled
			cursor not-allowed
			opacity 0.5
		&.button-with-icon-plus::before
			color var(--c-text-weak)
			content '+'
			left -2ch
			position absolute
	.button-badge
		border-radius 10px
		background var(--c-con-strong)
		font-size 0.5em
		font-weight bold
		padding 0 1ch
	.button-dropdown
		font inherit